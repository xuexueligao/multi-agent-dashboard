{
  "version": 3,
  "sources": ["../../../../../src/cli/lib/workos/platformApi.ts"],
  "sourcesContent": ["import { Context } from \"../../../bundler/context.js\";\nimport {\n  bigBrainAPI,\n  bigBrainAPIMaybeThrows,\n  ErrorData,\n  logAndHandleFetchError,\n  ThrowingFetchError,\n} from \"../utils/utils.js\";\nimport { components } from \"../../generatedApi.js\";\n\n// Re-export generated types for convenience\nexport type ProjectEnvironmentSummary =\n  components[\"schemas\"][\"ProjectEnvironmentSummary\"];\nexport type ProvisionProjectEnvironmentResponse =\n  components[\"schemas\"][\"ProvisionProjectEnvironmentResponse\"];\nexport type GetProjectEnvironmentResponse =\n  components[\"schemas\"][\"GetProjectEnvironmentResponse\"];\nexport type DeleteProjectEnvironmentResponse =\n  components[\"schemas\"][\"DeleteProjectEnvironmentResponse\"];\n\n/**\n * Verified emails for a user that aren't known to be an admin email for\n * another WorkOS integration.\n */\nexport async function getCandidateEmailsForWorkIntegration(\n  ctx: Context,\n): Promise<components[\"schemas\"][\"AvailableWorkOSTeamEmailsResponse\"]> {\n  return bigBrainAPI<\n    components[\"schemas\"][\"AvailableWorkOSTeamEmailsResponse\"]\n  >({\n    ctx,\n    method: \"GET\",\n    url: \"workos/available_workos_team_emails\",\n  });\n}\n\nexport async function getInvitationEligibleEmails(\n  ctx: Context,\n  teamId: number,\n): Promise<{\n  eligibleEmails: string[];\n  adminEmail?: string;\n}> {\n  return bigBrainAPI<{ eligibleEmails: string[]; adminEmail?: string }>({\n    ctx,\n    method: \"GET\",\n    url: `teams/${teamId}/workos_invitation_eligible_emails`,\n  });\n}\n\nexport async function getDeploymentCanProvisionWorkOSEnvironments(\n  ctx: Context,\n  deploymentName: string,\n): Promise<components[\"schemas\"][\"HasAssociatedWorkOSTeamResponse\"]> {\n  const request: components[\"schemas\"][\"HasAssociatedWorkOSTeamRequest\"] = {\n    deploymentName,\n  };\n  return bigBrainAPI<components[\"schemas\"][\"HasAssociatedWorkOSTeamResponse\"]>({\n    ctx,\n    method: \"POST\",\n    url: \"workos/has_associated_workos_team\",\n    data: request,\n  });\n}\n\nexport async function createEnvironmentAndAPIKey(\n  ctx: Context,\n  deploymentName: string,\n  environmentType?: \"production\" | \"nonproduction\",\n): Promise<\n  | {\n      success: true;\n      data: components[\"schemas\"][\"ProvisionEnvironmentResponse\"];\n    }\n  | {\n      success: false;\n      error: \"team_not_provisioned\";\n      message: string;\n    }\n> {\n  try {\n    const data = await bigBrainAPI<\n      components[\"schemas\"][\"ProvisionEnvironmentResponse\"]\n    >({\n      ctx,\n      method: \"POST\",\n      url: \"workos/get_or_provision_workos_environment\",\n      data: {\n        deploymentName,\n        environmentType,\n      },\n    });\n    return {\n      success: true,\n      data,\n    };\n  } catch (error: any) {\n    if (error?.message?.includes(\"WorkOSTeamNotProvisioned\")) {\n      return {\n        success: false,\n        error: \"team_not_provisioned\",\n        message: error.message,\n      };\n    }\n\n    return await ctx.crash({\n      exitCode: 1,\n      errorType: \"fatal\",\n      printedMessage: `Error provisioning WorkOS environment: ${error}`,\n    });\n  }\n}\n\nexport async function createAssociatedWorkosTeam(\n  ctx: Context,\n  teamId: number,\n  email: string,\n): Promise<\n  | {\n      result: \"success\";\n      workosTeamId: string;\n      workosTeamName: string;\n    }\n  | {\n      result: \"emailAlreadyUsed\";\n      message: string;\n    }\n> {\n  try {\n    const request: components[\"schemas\"][\"ProvisionWorkOSTeamRequest\"] = {\n      teamId,\n      email,\n    };\n    const result = (await bigBrainAPIMaybeThrows({\n      ctx,\n      method: \"POST\",\n      url: \"workos/provision_associated_workos_team\",\n      data: JSON.stringify(request),\n    })) as components[\"schemas\"][\"ProvisionWorkOSTeamResponse\"];\n    return {\n      result: \"success\",\n      ...result,\n    };\n  } catch (error) {\n    const data: ErrorData | undefined =\n      error instanceof ThrowingFetchError ? error.serverErrorData : undefined;\n    if (data?.code === \"WorkosAccountAlreadyExistsWithThisEmail\") {\n      return {\n        result: \"emailAlreadyUsed\",\n        message:\n          data?.message || \"WorkOS account with this email already exists\",\n      };\n    }\n    return await logAndHandleFetchError(ctx, error);\n  }\n}\n\n/**\n * Check if the WorkOS team associated with a Convex team is still accessible.\n * Returns the team info if provisioned, or null if not provisioned.\n */\nexport async function getWorkosTeamHealth(\n  ctx: Context,\n  teamId: number,\n): Promise<components[\"schemas\"][\"WorkOSTeamInfo\"] | null> {\n  const response = await bigBrainAPI<\n    components[\"schemas\"][\"WorkOSTeamHealthResponse\"]\n  >({\n    ctx,\n    method: \"GET\",\n    url: `teams/${teamId}/workos_team_health`,\n  });\n\n  // Return the team info if provisioned, otherwise null\n  return response.teamProvisioned ? (response.teamInfo ?? null) : null;\n}\n\n/**\n * Check if the WorkOS environment associated with a deployment is still accessible.\n * Returns null if the environment is not provisioned or cannot be accessed.\n */\nexport async function getWorkosEnvironmentHealth(\n  ctx: Context,\n  deploymentName: string,\n): Promise<components[\"schemas\"][\"WorkOSEnvironmentHealthResponse\"] | null> {\n  try {\n    return (await bigBrainAPIMaybeThrows({\n      ctx,\n      method: \"GET\",\n      url: `deployments/${deploymentName}/workos_environment_health`,\n    })) as components[\"schemas\"][\"WorkOSEnvironmentHealthResponse\"];\n  } catch (error: any) {\n    if (error?.serverErrorData?.code === \"WorkOSEnvironmentNotProvisioned\") {\n      return null;\n    }\n    return await logAndHandleFetchError(ctx, error);\n  }\n}\n\nexport async function disconnectWorkOSTeam(\n  ctx: Context,\n  teamId: number,\n): Promise<\n  | {\n      success: true;\n      workosTeamId: string;\n      workosTeamName: string;\n    }\n  | {\n      success: false;\n      error: \"not_associated\" | \"other\";\n      message: string;\n    }\n> {\n  try {\n    const request: components[\"schemas\"][\"DisconnectWorkOSTeamRequest\"] = {\n      teamId,\n    };\n    const result = (await bigBrainAPIMaybeThrows({\n      ctx,\n      method: \"POST\",\n      url: \"workos/disconnect_workos_team\",\n      data: JSON.stringify(request),\n    })) as components[\"schemas\"][\"DisconnectWorkOSTeamResponse\"];\n    return {\n      success: true,\n      ...result,\n    };\n  } catch (error) {\n    const data: ErrorData | undefined =\n      error instanceof ThrowingFetchError ? error.serverErrorData : undefined;\n    if (data?.code === \"WorkOSTeamNotAssociated\") {\n      return {\n        success: false,\n        error: \"not_associated\",\n        message: data?.message || \"No WorkOS team is associated\",\n      };\n    }\n    return {\n      success: false,\n      error: \"other\",\n      message:\n        data?.message ||\n        (error instanceof Error ? error.message : String(error)),\n    };\n  }\n}\n\nexport async function inviteToWorkosTeam(\n  ctx: Context,\n  teamId: number,\n  email: string,\n): Promise<\n  | {\n      result: \"success\";\n      email: string;\n      roleSlug: string;\n    }\n  | {\n      result: \"teamNotProvisioned\";\n      message: string;\n    }\n  | {\n      result: \"alreadyInWorkspace\";\n      message: string;\n    }\n> {\n  try {\n    const result = await bigBrainAPIMaybeThrows({\n      ctx,\n      method: \"POST\",\n      url: \"workos/invite_team_member\",\n      data: JSON.stringify({ teamId, email }),\n    });\n    return { result: \"success\", ...result };\n  } catch (error) {\n    const data: ErrorData | undefined =\n      error instanceof ThrowingFetchError ? error.serverErrorData : undefined;\n    if (data?.code === \"WorkOSTeamNotProvisioned\") {\n      return {\n        result: \"teamNotProvisioned\",\n        message: data?.message || \"This team doesn't have a WorkOS team yet\",\n      };\n    }\n    if (data?.code === \"WorkosUserAlreadyInWorkspace\") {\n      return {\n        result: \"alreadyInWorkspace\",\n        message:\n          data?.message ||\n          \"This email is already a member of another WorkOS workspace\",\n      };\n    }\n    if (data?.code === \"WorkosUserAlreadyInvited\") {\n      return {\n        result: \"alreadyInWorkspace\", // Reuse same result type for UI consistency\n        message:\n          data?.message ||\n          \"This email has already been invited to the WorkOS team\",\n      };\n    }\n    if (data?.code === \"WorkosUserAlreadyInThisTeam\") {\n      return {\n        result: \"alreadyInWorkspace\",\n        message:\n          data?.message || \"This email is already a member of this WorkOS team\",\n      };\n    }\n    return await logAndHandleFetchError(ctx, error);\n  }\n}\n\n// Project environment API functions\nexport async function listProjectWorkOSEnvironments(\n  ctx: Context,\n  projectId: number,\n): Promise<ProjectEnvironmentSummary[]> {\n  const response = await bigBrainAPI<\n    components[\"schemas\"][\"GetProjectEnvironmentsResponse\"]\n  >({\n    ctx,\n    method: \"GET\",\n    url: `projects/${projectId}/workos_environments`,\n  });\n  return response.environments;\n}\n\nexport async function createProjectWorkOSEnvironment(\n  ctx: Context,\n  projectId: number,\n  environmentName: string,\n  isProduction?: boolean,\n): Promise<ProvisionProjectEnvironmentResponse> {\n  return bigBrainAPI<ProvisionProjectEnvironmentResponse>({\n    ctx,\n    method: \"POST\",\n    url: `projects/${projectId}/workos_environments`,\n    data: { environmentName, isProduction },\n  });\n}\n\nexport async function getProjectWorkOSEnvironment(\n  ctx: Context,\n  projectId: number,\n  clientId: string,\n): Promise<GetProjectEnvironmentResponse> {\n  return bigBrainAPI<GetProjectEnvironmentResponse>({\n    ctx,\n    method: \"GET\",\n    url: `projects/${projectId}/workos_environments/${clientId}`,\n  });\n}\n\nexport async function deleteProjectWorkOSEnvironment(\n  ctx: Context,\n  projectId: number,\n  clientId: string,\n): Promise<DeleteProjectEnvironmentResponse> {\n  return bigBrainAPI<DeleteProjectEnvironmentResponse>({\n    ctx,\n    method: \"POST\",\n    url: \"workos/delete_project_environment\",\n    data: { projectId, clientId },\n  });\n}\n"],
  "mappings": "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",
  "names": []
}
