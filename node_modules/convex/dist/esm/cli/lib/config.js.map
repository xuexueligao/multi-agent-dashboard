{
  "version": 3,
  "sources": ["../../../../src/cli/lib/config.ts"],
  "sourcesContent": ["import { chalkStderr } from \"chalk\";\nimport path from \"path\";\nimport { z } from \"zod\";\nimport { Context } from \"../../bundler/context.js\";\nimport { TypescriptCompiler } from \"./typecheck.js\";\nimport {\n  changeSpinner,\n  logError,\n  logFailure,\n  logFinishedStep,\n  logMessage,\n  logWarning,\n  showSpinner,\n} from \"../../bundler/log.js\";\nimport {\n  Bundle,\n  BundleHash,\n  bundle,\n  bundleAuthConfig,\n  entryPointsByEnvironment,\n} from \"../../bundler/index.js\";\nimport { version } from \"../version.js\";\nimport { deploymentDashboardUrlPage } from \"./dashboard.js\";\nimport {\n  functionsDir,\n  ErrorData,\n  loadPackageJson,\n  deploymentFetch,\n  deprecationCheckWarning,\n  logAndHandleFetchError,\n  ThrowingFetchError,\n  currentPackageHomepage,\n} from \"./utils/utils.js\";\nimport { recursivelyDelete } from \"./fsUtils.js\";\nimport { NodeDependency } from \"./deployApi/modules.js\";\nimport { ComponentDefinitionPath } from \"./components/definition/directoryStructure.js\";\nimport {\n  LocalDeploymentError,\n  printLocalDeploymentOnError,\n} from \"./localDeployment/errors.js\";\nimport { debugIsolateBundlesSerially } from \"../../bundler/debugBundle.js\";\nimport { DeploymentType } from \"./api.js\";\nexport { productionProvisionHost, provisionHost } from \"./utils/utils.js\";\n\n/** Type representing WorkOS AuthKit integration configuration. */\nexport interface AuthKitConfigureSettings {\n  redirectUris?: string[];\n  appHomepageUrl?: string;\n  corsOrigins?: string[];\n}\n\nexport interface AuthKitEnvironmentConfig {\n  environmentType?: \"development\" | \"staging\" | \"production\";\n  configure?: false | AuthKitConfigureSettings;\n  localEnvVars?: false | Record<string, string>;\n}\n\nexport interface AuthKitConfig {\n  dev?: AuthKitEnvironmentConfig;\n  preview?: AuthKitEnvironmentConfig;\n  prod?: AuthKitEnvironmentConfig;\n}\n/**\n * convex.json file parsing notes\n *\n * - Unknown fields at the top level and in node and codegen are preserved\n *   so that older CLI versions can deploy new projects (this functionality\n *   will be removed in the future).\n * - convex.json does not allow comments, but this could change in the future.\n *   Previously it contained automatically set values like productionUrl\n *   but it's more like a config file now.\n */\n\n/** Type representing Convex project configuration. */\nexport interface ProjectConfig {\n  // \u26A0\uFE0F When updating this, please also update the file used by IDEs for autocompletion and validation:\n  // -> npm-packages/convex/schemas/convex.schema.json\n\n  functions: string;\n  node: {\n    externalPackages: string[];\n    // nodeVersion has no default value, its presence/absence is meaningful\n    nodeVersion?: string | undefined;\n  };\n  generateCommonJSApi: boolean;\n\n  codegen: {\n    staticApi: boolean;\n    staticDataModel: boolean;\n    legacyComponentApi?: boolean;\n    fileType?: \"ts\" | \"js/dts\";\n  };\n\n  bundler?: {\n    includeSourcesContent?: boolean;\n  };\n\n  typescriptCompiler?: TypescriptCompiler;\n\n  // WorkOS AuthKit integration configuration\n  authKit?: AuthKitConfig | undefined;\n}\n\nexport interface Config {\n  projectConfig: ProjectConfig;\n  modules: Bundle[];\n  nodeDependencies: NodeDependency[];\n  schemaId?: string;\n  udfServerVersion?: string;\n  nodeVersion?: string | undefined;\n}\n\nexport interface ConfigWithModuleHashes {\n  projectConfig: ProjectConfig;\n  moduleHashes: BundleHash[];\n  nodeDependencies: NodeDependency[];\n  schemaId?: string;\n  udfServerVersion?: string;\n}\n\nconst DEFAULT_FUNCTIONS_PATH = \"convex/\";\n\n/** Whether .ts file extensions should be used for generated code (default is false). */\nexport function usesTypeScriptCodegen(projectConfig: ProjectConfig): boolean {\n  return projectConfig.codegen.fileType === \"ts\";\n}\n\n/** Whether the new component API import style should be used (default is false) */\nexport function usesComponentApiImports(projectConfig: ProjectConfig): boolean {\n  return projectConfig.codegen.legacyComponentApi === false;\n}\n\n/**\n * Get the authKit configuration from convex.json.\n */\nexport async function getAuthKitConfig(\n  ctx: Context,\n  projectConfig: ProjectConfig,\n): Promise<AuthKitConfig | undefined> {\n  // If there's an explicit authKit config, use it\n  if (\"authKit\" in projectConfig) {\n    return projectConfig.authKit;\n  }\n\n  // TODO remove this after a few versions\n  // Migration help: is this one of the hardcoded templates that has special\n  // behavior without a convex.json? Encourage them to upgrade the template.\n  const homepage = await currentPackageHomepage(ctx);\n  const isOldWorkOSTemplate = !!(\n    homepage &&\n    [\n      \"https://github.com/workos/template-convex-nextjs-authkit/#readme\",\n      \"https://github.com/workos/template-convex-react-vite-authkit/#readme\",\n      \"https://github.com:workos/template-convex-react-vite-authkit/#readme\",\n      \"https://github.com/workos/template-convex-tanstack-start-authkit/#readme\",\n    ].includes(homepage)\n  );\n\n  if (isOldWorkOSTemplate) {\n    logWarning(\n      \"The template this project is based on has been updated to work with this version of Convex.\",\n    );\n    logWarning(\n      \"Please copy the convex.json from the latest template version or add an 'authKit' section.\",\n    );\n    logMessage(\"Learn more at https://docs.convex.dev/auth/authkit\");\n  }\n}\n\nexport async function getAuthKitEnvironmentConfig(\n  ctx: Context,\n  projectConfig: ProjectConfig,\n  deploymentType: \"dev\" | \"preview\" | \"prod\",\n): Promise<AuthKitEnvironmentConfig | undefined> {\n  const authKitConfig = await getAuthKitConfig(ctx, projectConfig);\n  return authKitConfig?.[deploymentType];\n}\n\n/** Error parsing ProjectConfig representation. */\nclass ParseError extends Error {}\n\n// WorkOS AuthKit configuration schemas\nconst AuthKitConfigureSchema = z.union([\n  z.literal(false),\n  z.object({\n    redirectUris: z.array(z.string()).optional(),\n    appHomepageUrl: z.string().optional(),\n    corsOrigins: z.array(z.string()).optional(),\n  }),\n]);\n\nconst AuthKitLocalEnvVarsSchema = z.union([\n  z.literal(false),\n  z.record(z.string()),\n]);\n\nconst AuthKitEnvironmentConfigSchema = z.object({\n  environmentType: z.enum([\"development\", \"staging\", \"production\"]).optional(),\n  configure: AuthKitConfigureSchema.optional(),\n  localEnvVars: AuthKitLocalEnvVarsSchema.optional(),\n});\n\nconst AuthKitConfigSchema = z\n  .object({\n    dev: AuthKitEnvironmentConfigSchema.optional(),\n    preview: AuthKitEnvironmentConfigSchema.optional(),\n    prod: AuthKitEnvironmentConfigSchema.optional(),\n  })\n  .refine(\n    (data) => {\n      // Validation: environmentType only allowed in prod\n      const devEnvType = data.dev?.environmentType;\n      const previewEnvType = data.preview?.environmentType;\n      if (devEnvType || previewEnvType) {\n        return false;\n      }\n      return true;\n    },\n    {\n      message: \"authKit.environmentType is only allowed in the prod section\",\n      path: [\"environmentType\"],\n    },\n  )\n  .refine(\n    (data) => {\n      // Validation: localEnvVars only allowed for dev\n      // Check preview doesn't have localEnvVars\n      if (\n        data.preview?.localEnvVars !== undefined &&\n        data.preview?.localEnvVars !== false\n      ) {\n        return false;\n      }\n      // Check prod doesn't have localEnvVars\n      if (\n        data.prod?.localEnvVars !== undefined &&\n        data.prod?.localEnvVars !== false\n      ) {\n        return false;\n      }\n      return true;\n    },\n    {\n      message:\n        \"authKit.localEnvVars is only supported for dev deployments. Preview and prod deployments must configure environment variables directly in the deployment platform.\",\n      path: [\"localEnvVars\"],\n    },\n  );\n// Separate Node and Codegen schemas so we can parse these loose or strict\nconst NodeSchema = z.object({\n  externalPackages: z\n    .array(z.string())\n    .default([])\n    .describe(\n      \"list of npm packages to install at deploy time instead of bundling. Packages with binaries should be added here.\",\n    ),\n  nodeVersion: z\n    .string()\n    .optional()\n    .describe(\"The Node.js version to use for Node.js functions\"),\n});\n\nconst CodegenSchema = z.object({\n  staticApi: z\n    .boolean()\n    .default(false)\n    .describe(\n      \"Use Convex function argument validators and return value validators to generate a typed API object\",\n    ),\n  staticDataModel: z.boolean().default(false),\n  // These optional fields have no defaults - their presence/absence is meaningful\n  legacyComponentApi: z.boolean().optional(),\n  fileType: z.enum([\"ts\", \"js/dts\"]).optional(),\n});\n\nconst BundlerSchema = z.object({\n  includeSourcesContent: z\n    .boolean()\n    .default(false)\n    .describe(\n      \"Whether to include original source code in source maps. Set to false to reduce bundle size.\",\n    ),\n});\n\nconst refineToObject = <T extends z.ZodTypeAny>(schema: T) =>\n  schema.refine((val) => val !== null && !Array.isArray(val), {\n    message: \"Expected `convex.json` to contain an object\",\n  });\n\n// Factory function to create schema with strict or passthrough behavior\nconst createProjectConfigSchema = (strict: boolean) => {\n  const nodeSchema = strict ? NodeSchema.strict() : NodeSchema.passthrough();\n  const codegenSchema = strict\n    ? CodegenSchema.strict()\n    : CodegenSchema.passthrough();\n  const bundlerSchema = strict\n    ? BundlerSchema.strict()\n    : BundlerSchema.passthrough();\n\n  const baseObject = z.object({\n    functions: z\n      .string()\n      .default(DEFAULT_FUNCTIONS_PATH)\n      .describe(\"Relative file path to the convex directory\"),\n    node: nodeSchema.default({ externalPackages: [] }),\n    codegen: codegenSchema.default({\n      staticApi: false,\n      staticDataModel: false,\n    }),\n    bundler: bundlerSchema.default({ includeSourcesContent: false }).optional(),\n    generateCommonJSApi: z.boolean().default(false),\n    typescriptCompiler: z\n      .enum([\"tsc\", \"tsgo\"])\n      .optional()\n      .describe(\n        \"TypeScript compiler to use for typechecking (`@typescript/native-preview` must be installed to use `tsgo`)\",\n      ),\n\n    // Optional $schema field for JSON schema validation in editors\n    $schema: z.string().optional(),\n    // WorkOS AuthKit integration configuration\n    authKit: AuthKitConfigSchema.optional(),\n\n    // Deprecated fields that have been deprecated for years, only here so we\n    // know it's safe to delete them.\n    project: z.string().optional(),\n    team: z.string().optional(),\n    prodUrl: z.string().optional(),\n  });\n\n  // Apply strict or passthrough BEFORE refine\n  const withStrictness = strict\n    ? baseObject.strict()\n    : baseObject.passthrough();\n\n  // Now apply the refinement\n  return withStrictness.refine(\n    (data) => {\n      // Validate that generateCommonJSApi is not true when using TypeScript codegen\n      if (data.generateCommonJSApi && data.codegen.fileType === \"ts\") {\n        return false;\n      }\n      return true;\n    },\n    {\n      message:\n        'Cannot use `generateCommonJSApi: true` with `codegen.fileType: \"ts\"`. ' +\n        \"CommonJS modules require JavaScript generation. \" +\n        'Either set `codegen.fileType: \"js/dts\"` or remove `generateCommonJSApi`.',\n      path: [\"generateCommonJSApi\"],\n    },\n  );\n};\n\n// Parse allowing extra fields (for forward compatibility)\nconst ProjectConfigSchema = refineToObject(createProjectConfigSchema(false));\n\n// Strict schema warn about extra keys\nconst ProjectConfigSchemaStrict = refineToObject(\n  createProjectConfigSchema(true),\n);\n\nconst warnedUnknownKeys = new Set<string>();\nexport function resetUnknownKeyWarnings() {\n  warnedUnknownKeys.clear();\n}\n\n/** Parse object to ProjectConfig. */\nexport async function parseProjectConfig(\n  ctx: Context,\n  obj: any,\n): Promise<ProjectConfig> {\n  if (typeof obj !== \"object\" || obj === null || Array.isArray(obj)) {\n    return await ctx.crash({\n      exitCode: 1,\n      errorType: \"invalid filesystem data\",\n      printedMessage: \"Expected `convex.json` to contain an object\",\n    });\n  }\n\n  try {\n    // Try strict parse first to detect unknown keys\n    return ProjectConfigSchemaStrict.parse(obj);\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      // Check if all issues are unrecognized_keys issues\n      const unknownKeyIssues = error.issues.filter(\n        (issue) => issue.code === \"unrecognized_keys\",\n      );\n\n      if (\n        unknownKeyIssues.length > 0 &&\n        unknownKeyIssues.length === error.issues.length\n      ) {\n        // All errors are just unknown keys - warn about them\n        for (const issue of unknownKeyIssues) {\n          if (issue.code === \"unrecognized_keys\") {\n            const pathPrefix =\n              issue.path.length > 0 ? issue.path.join(\".\") + \".\" : \"\";\n            const unknownKeys = issue.keys as string[];\n            const newUnknownKeys = unknownKeys.filter(\n              (key) => !warnedUnknownKeys.has(pathPrefix + key),\n            );\n\n            if (newUnknownKeys.length > 0) {\n              const fullPath =\n                issue.path.length > 0\n                  ? `\\`${issue.path.join(\".\")}\\``\n                  : \"`convex.json`\";\n              logMessage(\n                chalkStderr.yellow(\n                  `Warning: Unknown ${newUnknownKeys.length === 1 ? \"property\" : \"properties\"} in ${fullPath}: ${newUnknownKeys.map((k) => `\\`${k}\\``).join(\", \")}`,\n                ),\n              );\n              logMessage(\n                chalkStderr.gray(\n                  \"  These properties will be preserved but are not recognized by this version of Convex.\",\n                ),\n              );\n\n              // Track that we've warned about these keys\n              newUnknownKeys.forEach((key) =>\n                warnedUnknownKeys.add(pathPrefix + key),\n              );\n            }\n          }\n        }\n        // Re-parse with passthrough schema to preserve unknown keys\n        return ProjectConfigSchema.parse(obj);\n      }\n\n      // Handle validation errors we won't ignore\n      if (error instanceof z.ZodError) {\n        const issue = error.issues[0];\n        const pathStr = issue.path.join(\".\");\n        const message = pathStr\n          ? `\\`${pathStr}\\` in \\`convex.json\\`: ${issue.message}`\n          : `\\`convex.json\\`: ${issue.message}`;\n        return await ctx.crash({\n          exitCode: 1,\n          errorType: \"invalid filesystem data\",\n          printedMessage: message,\n        });\n      }\n    }\n    return await ctx.crash({\n      exitCode: 1,\n      errorType: \"invalid filesystem data\",\n      printedMessage: (error as any).toString(),\n    });\n  }\n}\n\n// Parse a deployment config returned by the backend, picking out\n// the fields we care about.\nfunction parseBackendConfig(obj: any): {\n  functions: string;\n  nodeVersion?: string;\n} {\n  function throwParseError(message: string) {\n    // Unexpected error\n    // eslint-disable-next-line no-restricted-syntax\n    throw new ParseError(message);\n  }\n  if (typeof obj !== \"object\") {\n    throwParseError(\"Expected an object\");\n  }\n  const { functions, nodeVersion } = obj;\n  if (typeof functions !== \"string\") {\n    throwParseError(\"Expected functions to be a string\");\n  }\n\n  if (typeof nodeVersion !== \"undefined\" && typeof nodeVersion !== \"string\") {\n    throwParseError(\"Expected nodeVersion to be a string\");\n  }\n\n  return {\n    functions,\n    ...((nodeVersion ?? null) !== null ? { nodeVersion: nodeVersion } : {}),\n  };\n}\n\nexport function configName(): string {\n  return \"convex.json\";\n}\n\nexport async function configFilepath(ctx: Context): Promise<string> {\n  const configFn = configName();\n  // We used to allow src/convex.json, but no longer (as of 10/7/2022).\n  // Leave an error message around to help people out. We can remove this\n  // error message after a couple months.\n  const preferredLocation = configFn;\n  const wrongLocation = path.join(\"src\", configFn);\n\n  // Allow either location, but not both.\n  const preferredLocationExists = ctx.fs.exists(preferredLocation);\n  const wrongLocationExists = ctx.fs.exists(wrongLocation);\n  if (preferredLocationExists && wrongLocationExists) {\n    const message = `${chalkStderr.red(`Error: both ${preferredLocation} and ${wrongLocation} files exist!`)}\\nConsolidate these and remove ${wrongLocation}.`;\n    return await ctx.crash({\n      exitCode: 1,\n      errorType: \"invalid filesystem data\",\n      printedMessage: message,\n    });\n  }\n  if (!preferredLocationExists && wrongLocationExists) {\n    return await ctx.crash({\n      exitCode: 1,\n      errorType: \"invalid filesystem data\",\n      printedMessage: `Error: Please move ${wrongLocation} to the root of your project`,\n    });\n  }\n\n  return preferredLocation;\n}\n\nexport async function getFunctionsDirectoryPath(ctx: Context): Promise<string> {\n  const { projectConfig, configPath } = await readProjectConfig(ctx);\n  return functionsDir(configPath, projectConfig);\n}\n\n/** Read configuration from a local `convex.json` file. */\nexport async function readProjectConfig(ctx: Context): Promise<{\n  projectConfig: ProjectConfig;\n  configPath: string;\n}> {\n  if (!ctx.fs.exists(\"convex.json\")) {\n    // create-react-app bans imports from outside of src, so we can just\n    // put the functions directory inside of src/ to work around this issue.\n    const packages = await loadPackageJson(ctx);\n    const isCreateReactApp = \"react-scripts\" in packages;\n    return {\n      projectConfig: {\n        functions: isCreateReactApp\n          ? `src/${DEFAULT_FUNCTIONS_PATH}`\n          : DEFAULT_FUNCTIONS_PATH,\n        node: {\n          externalPackages: [],\n        },\n        generateCommonJSApi: false,\n        codegen: {\n          staticApi: false,\n          staticDataModel: false,\n        },\n      },\n      configPath: configName(),\n    };\n  }\n  let projectConfig;\n  const configPath = await configFilepath(ctx);\n  try {\n    projectConfig = await parseProjectConfig(\n      ctx,\n      JSON.parse(ctx.fs.readUtf8File(configPath)),\n    );\n  } catch (err) {\n    if (err instanceof ParseError || err instanceof SyntaxError) {\n      logError(chalkStderr.red(`Error: Parsing \"${configPath}\" failed`));\n      logMessage(chalkStderr.gray(err.toString()));\n    } else {\n      logFailure(\n        `Error: Unable to read project config file \"${configPath}\"\\n` +\n          \"  Are you running this command from the root directory of a Convex project? If so, run `npx convex dev` first.\",\n      );\n      if (err instanceof Error) {\n        logError(chalkStderr.red(err.message));\n      }\n    }\n    return await ctx.crash({\n      exitCode: 1,\n      errorType: \"invalid filesystem data\",\n      errForSentry: err,\n      // TODO -- move the logging above in here\n      printedMessage: null,\n    });\n  }\n  return {\n    projectConfig,\n    configPath,\n  };\n}\n\n/**\n * Given a {@link ProjectConfig}, add in the bundled modules to produce the\n * complete config.\n */\nexport async function configFromProjectConfig(\n  ctx: Context,\n  projectConfig: ProjectConfig,\n  configPath: string,\n  verbose: boolean,\n): Promise<{\n  config: Config;\n  bundledModuleInfos: BundledModuleInfo[];\n}> {\n  const baseDir = functionsDir(configPath, projectConfig);\n  // We bundle Node.js and Convex JS runtime functions entry points separately\n  // since they execute on different platforms.\n  const entryPoints = await entryPointsByEnvironment(ctx, baseDir);\n  // es-build prints errors to console which would clobber our spinner.\n  if (verbose) {\n    showSpinner(\"Bundling modules for Convex's runtime...\");\n  }\n  const convexResult = await bundle({\n    ctx,\n    dir: baseDir,\n    entryPoints: entryPoints.isolate,\n    generateSourceMaps: true,\n    platform: \"browser\",\n  });\n  if (verbose) {\n    logMessage(\n      \"Convex's runtime modules: \",\n      convexResult.modules.map((m) => m.path),\n    );\n  }\n\n  // Bundle node modules.\n  if (verbose && entryPoints.node.length !== 0) {\n    showSpinner(\"Bundling modules for Node.js runtime...\");\n  }\n  const nodeResult = await bundle({\n    ctx,\n    dir: baseDir,\n    entryPoints: entryPoints.node,\n    generateSourceMaps: true,\n    platform: \"node\",\n    chunksFolder: path.join(\"_deps\", \"node\"),\n    externalPackagesAllowList: projectConfig.node.externalPackages,\n  });\n  if (verbose && entryPoints.node.length !== 0) {\n    logMessage(\n      \"Node.js runtime modules: \",\n      nodeResult.modules.map((m) => m.path),\n    );\n    if (projectConfig.node.externalPackages.length > 0) {\n      logMessage(\n        \"Node.js runtime external dependencies (to be installed on the server): \",\n        [...nodeResult.externalDependencies.entries()].map(\n          (a) => `${a[0]}: ${a[1]}`,\n        ),\n      );\n    }\n  }\n  const modules = convexResult.modules;\n  modules.push(...nodeResult.modules);\n  modules.push(...(await bundleAuthConfig(ctx, baseDir)));\n\n  const nodeDependencies: NodeDependency[] = [];\n  for (const [moduleName, moduleVersion] of nodeResult.externalDependencies) {\n    nodeDependencies.push({ name: moduleName, version: moduleVersion });\n  }\n\n  const bundledModuleInfos: BundledModuleInfo[] = Array.from(\n    convexResult.bundledModuleNames.keys(),\n  ).map((moduleName) => {\n    return {\n      name: moduleName,\n      platform: \"convex\",\n    };\n  });\n  bundledModuleInfos.push(\n    ...Array.from(nodeResult.bundledModuleNames.keys()).map(\n      (moduleName): BundledModuleInfo => {\n        return {\n          name: moduleName,\n          platform: \"node\",\n        };\n      },\n    ),\n  );\n\n  return {\n    config: {\n      projectConfig: projectConfig,\n      modules: modules,\n      nodeDependencies: nodeDependencies,\n      // We're just using the version this CLI is running with for now.\n      // This could be different than the version of `convex` the app runs with\n      // if the CLI is installed globally.\n      udfServerVersion: version,\n      nodeVersion: projectConfig.node.nodeVersion,\n    },\n    bundledModuleInfos,\n  };\n}\n\n/**\n * Bundle modules one by one for good bundler errors.\n */\nexport async function debugIsolateEndpointBundles(\n  ctx: Context,\n  projectConfig: ProjectConfig,\n  configPath: string,\n): Promise<void> {\n  const baseDir = functionsDir(configPath, projectConfig);\n  const entryPoints = await entryPointsByEnvironment(ctx, baseDir);\n  if (entryPoints.isolate.length === 0) {\n    logFinishedStep(\"No non-'use node' modules found.\");\n  }\n  await debugIsolateBundlesSerially(ctx, {\n    entryPoints: entryPoints.isolate,\n    extraConditions: [],\n    dir: baseDir,\n  });\n}\n\n/**\n * Read the config from `convex.json` and bundle all the modules.\n */\nexport async function readConfig(\n  ctx: Context,\n  verbose: boolean,\n): Promise<{\n  config: Config;\n  configPath: string;\n  bundledModuleInfos: BundledModuleInfo[];\n}> {\n  const { projectConfig, configPath } = await readProjectConfig(ctx);\n  const { config, bundledModuleInfos } = await configFromProjectConfig(\n    ctx,\n    projectConfig,\n    configPath,\n    verbose,\n  );\n  return { config, configPath, bundledModuleInfos };\n}\n\n/**\n * Ensure the functions directory exists.\n *\n * Note: This function no longer writes to or deletes `convex.json`. The config\n * file is now treated as user-owned and is not modified by the CLI. This allows\n * users to maintain their preferred formatting and any comments they may add\n * (if we later support JSONC parsing).\n */\nexport async function writeProjectConfig(\n  ctx: Context,\n  projectConfig: ProjectConfig,\n) {\n  const configPath = await configFilepath(ctx);\n  ctx.fs.mkdir(functionsDir(configPath, projectConfig), {\n    allowExisting: true,\n  });\n}\n\nexport function removedExistingConfig(\n  ctx: Context,\n  configPath: string,\n  options: { allowExistingConfig?: boolean },\n) {\n  if (!options.allowExistingConfig) {\n    return false;\n  }\n  recursivelyDelete(ctx, configPath);\n  logFinishedStep(`Removed existing ${configPath}`);\n  return true;\n}\n\n/** Pull configuration for the root app component from the given remote origin. */\nexport async function pullConfig(\n  ctx: Context,\n  project: string | undefined,\n  team: string | undefined,\n  origin: string,\n  adminKey: string,\n): Promise<ConfigWithModuleHashes> {\n  const fetch = deploymentFetch(ctx, {\n    deploymentUrl: origin,\n    adminKey,\n  });\n\n  changeSpinner(\"Downloading current deployment state...\");\n  try {\n    const res = await fetch(\"/api/get_config_hashes\", {\n      method: \"POST\",\n      body: JSON.stringify({ version, adminKey }),\n    });\n    deprecationCheckWarning(ctx, res);\n    const data = await res.json();\n    const backendConfig = parseBackendConfig(data.config);\n    const projectConfig = {\n      ...backendConfig,\n      node: {\n        // This field is not stored in the backend, which is ok since it is also\n        // not used to diff configs.\n        externalPackages: [],\n        nodeVersion: data.nodeVersion,\n      },\n      // This field is not stored in the backend, it only affects the client.\n      generateCommonJSApi: false,\n      // This field is also not stored in the backend, it only affects the client.\n      codegen: {\n        staticApi: false,\n        staticDataModel: false,\n      },\n      project,\n      team,\n      prodUrl: origin,\n    };\n    return {\n      projectConfig,\n      moduleHashes: data.moduleHashes,\n      // TODO(presley): Add this to diffConfig().\n      nodeDependencies: data.nodeDependencies,\n      udfServerVersion: data.udfServerVersion,\n    };\n  } catch (err: unknown) {\n    logFailure(`Error: Unable to pull deployment config from ${origin}`);\n    return await logAndHandleFetchError(ctx, err);\n  }\n}\n\ninterface BundledModuleInfo {\n  name: string;\n  platform: \"node\" | \"convex\";\n}\n\n/**\n * A component definition spec contains enough information to create bundles\n * of code that must be analyzed in order to construct a ComponentDefinition.\n *\n * Most paths are relative to the directory of the definitionPath.\n */\nexport type ComponentDefinitionSpec = {\n  /** This path is relative to the app (root component) directory. */\n  definitionPath: ComponentDefinitionPath;\n\n  /** Dependencies are paths to the directory of the dependency component definition from the app (root component) directory */\n  dependencies: ComponentDefinitionPath[];\n\n  // All other paths are relative to the directory of the definitionPath above.\n  definition: Bundle;\n  schema: Bundle;\n  functions: Bundle[];\n};\n\nexport type AppDefinitionSpec = Omit<\n  ComponentDefinitionSpec,\n  \"definitionPath\"\n> & {\n  // Only app (root) component specs contain an auth bundle.\n  auth: Bundle | null;\n};\n\nexport type ComponentDefinitionSpecWithoutImpls = Omit<\n  ComponentDefinitionSpec,\n  \"schema\" | \"functions\"\n>;\nexport type AppDefinitionSpecWithoutImpls = Omit<\n  AppDefinitionSpec,\n  \"schema\" | \"functions\" | \"auth\"\n>;\n\n/** Generate a human-readable diff between the two configs. */\nexport function diffConfig(\n  oldConfig: ConfigWithModuleHashes,\n  newConfig: Config,\n): { diffString: string } {\n  let diff = \"\";\n\n  let versionMessage = \"\";\n  const matches = oldConfig.udfServerVersion === newConfig.udfServerVersion;\n  if (oldConfig.udfServerVersion && (!newConfig.udfServerVersion || !matches)) {\n    versionMessage += `[-] ${oldConfig.udfServerVersion}\\n`;\n  }\n  if (newConfig.udfServerVersion && (!oldConfig.udfServerVersion || !matches)) {\n    versionMessage += `[+] ${newConfig.udfServerVersion}\\n`;\n  }\n  if (versionMessage) {\n    diff += \"Change the server's function version:\\n\";\n    diff += versionMessage;\n  }\n\n  if (oldConfig.projectConfig.node.nodeVersion !== newConfig.nodeVersion) {\n    diff += \"Change the server's version for Node.js actions:\\n\";\n    if (oldConfig.projectConfig.node.nodeVersion) {\n      diff += `[-] ${oldConfig.projectConfig.node.nodeVersion}\\n`;\n    }\n    if (newConfig.nodeVersion) {\n      diff += `[+] ${newConfig.nodeVersion}\\n`;\n    }\n  }\n\n  return { diffString: diff };\n}\n\n/** Handle an error from\n * legacy push path:\n * - /api/push_config\n * modern push paths:\n * - /api/deploy2/evaluate_push\n * - /api/deploy2/start_push\n * - /api/deploy2/finish_push\n *\n * finish_push errors are different from start_push errors and in theory could\n * be handled differently, but starting over works for all of them.\n */\nexport async function handlePushConfigError(\n  ctx: Context,\n  error: unknown,\n  defaultMessage: string,\n  deploymentName: string | null,\n  deployment:\n    | {\n        deploymentUrl: string;\n        adminKey: string;\n        deploymentNotice: string;\n      }\n    | undefined,\n  _deploymentType: DeploymentType | undefined,\n): Promise<never> {\n  const data: ErrorData | undefined =\n    error instanceof ThrowingFetchError ? error.serverErrorData : undefined;\n  if (data?.code === \"AuthConfigMissingEnvironmentVariable\") {\n    const errorMessage = data.message || \"(no error message given)\";\n    const [, variableName] =\n      errorMessage.match(/Environment variable (\\S+)/i) ?? [];\n\n    // DEPRECATED: This error path provisioning is being phased out in favor of\n    // pre-flight provisioning that happens before the client bundle build.\n    // We keep minimal logic here for backwards compatibility with older templates\n    // that may still rely on this path.\n    if (variableName === \"WORKOS_CLIENT_ID\" && deploymentName && deployment) {\n      // For backwards compatibility with templates that haven't been updated,\n      // we'll still show a helpful error message directing users to configure WorkOS.\n      // But we no longer do automatic provisioning here since it happens too late\n      // (after the client bundle has already been built with missing env vars).\n      logWarning(\n        \"WORKOS_CLIENT_ID is not set; you can set it manually on the deployment or for hosted Convex deployments, use auto-provisioning.\",\n      );\n      logMessage(\n        \"Learn more at https://docs.convex.dev/auth/authkit/auto-provision\",\n      );\n      logMessage(\"\");\n    }\n\n    const envVarMessage =\n      `Environment variable ${chalkStderr.bold(\n        variableName,\n      )} is used in auth config file but ` + `its value was not set.`;\n    let setEnvVarInstructions =\n      \"Go set it in the dashboard or using `npx convex env set`\";\n\n    // If `npx convex dev` is running using --url there might not be a configured deployment\n    if (deploymentName !== null) {\n      const variableQuery =\n        variableName !== undefined ? `?var=${variableName}` : \"\";\n      const dashboardUrl = deploymentDashboardUrlPage(\n        deploymentName,\n        `/settings/environment-variables${variableQuery}`,\n      );\n      setEnvVarInstructions = `Go to:\\n\\n    ${chalkStderr.bold(\n        dashboardUrl,\n      )}\\n\\n  to set it up. `;\n    }\n    await ctx.crash({\n      exitCode: 1,\n      errorType: \"invalid filesystem or env vars\",\n      errForSentry: error,\n      printedMessage: envVarMessage + \"\\n\" + setEnvVarInstructions,\n    });\n  }\n\n  if (data?.code === \"RaceDetected\") {\n    // Environment variables or schema changed during push. This is a transient\n    // error that should be retried immediately with exponential backoff.\n    const message =\n      data.message || \"Schema or environment variables changed during push\";\n    return await ctx.crash({\n      exitCode: 1,\n      errorType: \"transient\",\n      errForSentry: error,\n      printedMessage: chalkStderr.yellow(message),\n    });\n  }\n\n  if (data?.code === \"InternalServerError\") {\n    if (deploymentName?.startsWith(\"local-\")) {\n      printLocalDeploymentOnError();\n      return ctx.crash({\n        exitCode: 1,\n        errorType: \"fatal\",\n        errForSentry: new LocalDeploymentError(\n          \"InternalServerError while pushing to local deployment\",\n        ),\n        printedMessage: defaultMessage,\n      });\n    }\n  }\n\n  logFailure(defaultMessage);\n  return await logAndHandleFetchError(ctx, error);\n}\n"],
  "mappings": "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",
  "names": []
}
